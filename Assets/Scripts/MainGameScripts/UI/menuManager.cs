using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class menuManager : MonoBehaviour
{
    public KeyCode activationKey;

    public ScrollRect scrollRect;
    public int totalPages = 3;
    public float transitionSpeed = 5f;
    public bool active;

    [SerializeField] private int currentPage;
    [SerializeField] private int startPage;
    private float targetPos;

    public RectTransform panel;
    public Vector2 hiddenPos;  // 숨겨진 위치 (위로)
    public Vector2 shownPos;     // 보이는 위치
    public Vector2 verticalTargetPos;

    private void Start()
    {
        panel.anchoredPosition = hiddenPos;
        active = false;
        verticalTargetPos = hiddenPos;
        targetPos = (float)currentPage / (totalPages - 1);
    }

    void Update()
    {
        if (Input.GetKeyDown(activationKey))
            ToggleMenu();

        float dt = Time.unscaledDeltaTime;
        panel.anchoredPosition = Vector2.Lerp(panel.anchoredPosition, verticalTargetPos, dt * transitionSpeed);

        if (!active) return;

        // 좌우 키 입력
        if (Input.GetKeyDown(KeyCode.Q)) SlideToPage(currentPage - 1);
        if (Input.GetKeyDown(KeyCode.E)) SlideToPage(currentPage + 1);

        // 부드럽게 이동
        scrollRect.horizontalNormalizedPosition = Mathf.Lerp(
            scrollRect.horizontalNormalizedPosition,
            targetPos,
            Time.deltaTime * transitionSpeed
        );
    }

    void SlideToPage(int pageIndex)
    {
        Debug.Log("kb hit");
        currentPage = Mathf.Clamp(pageIndex, 0, totalPages - 1);
        targetPos = (float)currentPage / (totalPages - 1); // 0.0 ~ 1.0 사이 값
    }

    void ToggleMenu()
    {
        active = !active;
        verticalTargetPos = active ? shownPos : hiddenPos;

        if (active)
        {
            GameManager.Instance.GamePause();
            AudioListener.pause = true;     // 선택 사항: 오디오 일시정지
        }
        else
        {
            GameManager.Instance.GamePause();
            AudioListener.pause = false;
        }
    }
}
